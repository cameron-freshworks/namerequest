<template>
  <v-container id="landing-container" class="ma-0 pa-0" fluid>
    <v-container class="header-container">
      <v-row id="upper-row">
        <v-col cols="12" md="4" lg="4" :class="{ 'name-request-title' : !isMobile }">
          <span class="h2 colour-white">Name Request
            <v-tooltip bottom nudge-right="10"
                       nudge-top="5"
                       content-class="bottom-tooltip tooltip-extra-wide"
                       transition="fade-transition"
                       class="test-class"
                       :open-on-hover="false"
                       :disabled="isMobile"
            >
              <template v-slot:activator="{ on }">
                <v-btn v-if="!isMobile"
                        class="beta-wrapper-btn ml-n2 mb-n2 pa-0"
                       @click="on.click"
                       @blur="on.blur"
                       :ripple="false"
                       retain-focus-on-click
                >
                  <sup class="beta-tag">Beta</sup>
                </v-btn>
                <sup v-else class="beta-tag">Beta</sup>
              </template>
              <p>The Name Request website is available as a Beta version. Name requests obtained through the Name
                Request Beta website are official name requests and can be used in the province of British Columbia.</p>
              <p class="mb-0">The Name Request Beta website contains all of the functionality of the previous Name
                Requests Online site, as well as new functionality intended to improve the experience of starting and
                managing businesses in B.C. Some features of the site may not function as intended, and if you encounter
                this please contact us:</p>
              <span class="tooltip-bullet mt-3">
                <a class="white--text" href="tel:+1-877-370-1033" target="_blank">Toll Free: 1-877-370-1033</a>
              </span>
              <span class="tooltip-bullet">
                <a class="white--text" href="tel:+1-250-370-1033" target="_blank">Victoria Office: 250-370-1033</a>
              </span>
              <span class="tooltip-bullet mb-3">
                <a class="white--text" href="mailto:BCRegistries@gov.bc.ca" target="_blank">BCRegistries@gov.bc.ca</a>
              </span>
              <p class="mb-0">As part of a
                <a class="white--text" :href="agileUrl" target="_blank">modern agile software development process</a>
                the Name Request website will be continually updated and improved based on feedback from citizens and
                businesses in B.C.
              </p>
            </v-tooltip>
          </span>
        </v-col>
        <v-col v-if="!isMobile" cols="12" md="8" lg="8" :class="isMobile ? 'mt-n2' : 'mt-4'">
          <Stats />
        </v-col>
      </v-row>
    </v-container>
    <v-row no-gutters>
      <v-col cols="12">
        <transition name="fade" mode="out-in" :duration="{ enter: 100, leave: 100 }">
          <component :is="displayedComponent" :key="displayedComponent" transition="fade-transition" />
        </transition>
      </v-col>
    </v-row>
    <v-row id="lower-row" no-gutters>
      <LowerContainer :class="{ 'mt-10' : !isMobile }"/>
    </v-row>
 </v-container>
</template>

<script lang="ts">
import { Vue, Component, Prop } from 'vue-property-decorator'

import AnalyzeCharacters from '@/components/new-request/analyze-characters.vue'
import AnalyzePending from '@/components/new-request/analyze-pending.vue'
import AnalyzeResults from '@/components/new-request/analyze-results.vue'
import SendToExamination from '@/components/new-request/send-to-examination.vue'
import ExistingRequestDisplay from '@/components/existing-request/existing-request-display.vue'
import ExistingRequestEdit from '@/components/existing-request/existing-request-edit.vue'
import LowerContainer from '@/components/lower-info-area/lower-container.vue'
import QuickSearchPending from '@/components/new-request/quick-search-pending.vue'
import QuickSearchResults from '@/components/new-request/quick-search-results.vue'
import SearchPending from '@/components/existing-request/search-pending.vue'
import Stats from '@/components/new-request/stats.vue'
import SubmissionTabs from '@/components/new-request/submit-request/submission-tabs.vue'
import Success from '@/components/common/success.vue'
import Tabs from '@/components/tabs.vue'
import newRequestModule from '@/store/new-request-module'

@Component({
  components: {
    AnalyzeCharacters,
    AnalyzePending,
    AnalyzeResults,
    SendToExamination,
    ExistingRequestDisplay,
    ExistingRequestEdit,
    LowerContainer,
    QuickSearchPending,
    QuickSearchResults,
    SearchPending,
    Stats,
    SubmissionTabs,
    Success,
    Tabs
  }
})
export default class Landing extends Vue {
  @Prop(String) id: string
  private agileUrl = 'https://www2.gov.bc.ca/gov/content/employment-business/business/managing-a-business' +
    '/permits-licences/news-updates/modernization'

  async mounted () {
    const { id } = this
    // If the ID prop is set, load the existing NR
    if (id) {
      await this.fetchNr(+id)
    }
  }

  get isMobile (): boolean {
    return window.screen.width < this.$vuetify.breakpoint.thresholds.xs
  }

  async fetchNr (nrId: number): Promise<void> {
    const nrData = await newRequestModule.getNameRequest(nrId)
    await newRequestModule.loadExistingNameRequest(nrData)
  }

  get displayedComponent () {
    return newRequestModule.displayedComponent
  }
}
</script>

<style lang="scss" scoped>
@import '@/assets/scss/theme.scss';

.header-container {
  max-width: 1180px;
}

.name-request-title {
  padding-top: 4rem;
}

#upper-row {
  color: white;
}

.beta-tag {
  top: -1rem;
  color: $BCgovGold5;
  font-size: 19px;
  font-weight: bold;
  text-transform: uppercase;
  &:hover {
    cursor: pointer;
  }
}
.beta-wrapper-btn {
  background-color: inherit !important;
  box-shadow: unset !important;
  font: inherit !important;
  height: inherit !important;
  &:before {
    background-color: inherit !important;
  }
}
.v-tooltip__content {
  pointer-events: auto !important;
}
.tooltip-extra-wide {
  max-width: 410px !important;
}
</style>
